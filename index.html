<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IpaVip Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ffcc00;
    }
    form, .game-list {
      background: #222;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      margin: 20px auto;
    }
    input, textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      border: none;
      border-radius: 5px;
    }
    button {
      padding: 10px 20px;
      background: #ffcc00;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .game {
      margin: 10px 0;
      padding: 10px;
      border-bottom: 1px solid #444;
    }
    .actions button {
      margin-left: 10px;
      background: #e74c3c;
      color: #fff;
    }
  </style>
</head>
<body>
  <h1>üõ† IpaVip Admin Panel</h1>
  <form id="appForm">
    <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required />
    <input type="text" id="bundleID" placeholder="Bundle ID" required />
    <input type="text" id="version" placeholder="–í–µ—Ä—Å–∏—è" required />
    <input type="number" id="size" placeholder="–†–∞–∑–º–µ—Ä (–≤ –±–∞–π—Ç–∞—Ö)" required />
    <input type="text" id="downloadURL" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ IPA" required />
    <input type="text" id="iconURL" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∫–æ–Ω–∫—É" required />
    <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
    <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
  </form>

  <div class="game-list" id="gameList">
    <h2>–°–ø–∏—Å–æ–∫ –∏–≥—Ä</h2>
    <div id="gamesContainer"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRmKbekcv6OW8oaMsHPlc8WvfIWnyFAI0",
      authDomain: "appgamesrepo.firebaseapp.com",
      databaseURL: "https://appgamesrepo-default-rtdb.firebaseio.com",
      projectId: "appgamesrepo",
      storageBucket: "appgamesrepo.firebasestorage.app",
      messagingSenderId: "220298514248",
      appId: "1:220298514248:web:f3193a6042d3e1a67a6d7d",
      measurementId: "G-0YVBYHKG2D"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const form = document.getElementById('appForm');
    const gamesContainer = document.getElementById('gamesContainer');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const newApp = {
        name: form.name.value,
        type: 1,
        bundleID: form.bundleID.value,
        bundleIdentifier: form.bundleID.value,
        version: form.version.value,
        size: parseInt(form.size.value),
        down: form.downloadURL.value,
        downloadURL: form.downloadURL.value,
        developerName: "",
        localizedDescription: form.description.value,
        icon: form.iconURL.value,
        iconURL: form.iconURL.value,
        appUpdateTime: new Date().toISOString()
      };

      const newPostKey = push(ref(db, 'apps')).key;
      await set(ref(db, 'apps/' + newPostKey), newApp);
      form.reset();
    });

    function loadGames() {
      onValue(ref(db, 'apps'), (snapshot) => {
        gamesContainer.innerHTML = '';
        const data = snapshot.val();
        if (data) {
          Object.entries(data).forEach(([key, app]) => {
            const div = document.createElement('div');
            div.className = 'game';
            div.innerHTML = `
              <strong>${app.name}</strong> (${app.version})<br />
              <img src="${app.iconURL}" width="40"> ${app.bundleID}<br />
              <div class="actions">
                <button onclick="deleteApp('${key}')">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            `;
            gamesContainer.appendChild(div);
          });
        }
      });
    }

    window.deleteApp = async (key) => {
      await remove(ref(db, 'apps/' + key));
    };

    loadGames();
  </script>
</body>
</html>
